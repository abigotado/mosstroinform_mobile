# Руководство по использованию моковых данных

## Обзор

Для разработки и демонстрации приложения используются интерактивные моковые данные, которые имитируют работу реального API. Моки позволяют показать полный пользовательский путь без необходимости создания реального бэкенда.

## Как работают моки

### Интерактивное состояние

Моковые данные используют **Riverpod** для управления состоянием в памяти:

- Данные хранятся в памяти во время работы приложения
- Изменения (одобрение документов, отправка запросов) сохраняются до перезапуска
- Состояние сбрасывается при полном перезапуске приложения
- Это позволяет демонстрировать интерактивность приложения

### Переключение между моками и реальным API

Моки включаются автоматически при использовании flavor `dev`:

- **dev** flavor → `useMocks: true` (используются моки)
- **staging** flavor → `useMocks: false` (используется реальный API)
- **prod** flavor → `useMocks: false` (используется реальный API)

Конфигурация находится в `lib/core/config/app_config_simple.dart`.

## Структура моковых данных

Моковые данные организованы по фичам в `lib/core/data/mock_data/`:

- `projects_mock_data.dart` - начальные данные проектов
- `documents_mock_data.dart` - начальные данные документов
- `construction_mock_data.dart` - данные этапа строительства (камеры)
- `chat_mock_data.dart` - данные чата со специалистами
- `completion_mock_data.dart` - финальные документы
- `mock_state_providers.dart` - Riverpod провайдеры для управления состоянием

## Интерактивные моки

### Как это работает

1. **Начальное состояние** загружается из статических данных в `mock_data/*.dart`
2. **Состояние хранится** в памяти через Riverpod провайдеры (`mock_state_providers.dart`)
3. **Изменения применяются** к состоянию в памяти (одобрение документов, отправка запросов)
4. **UI автоматически обновляется** через Riverpod watch

### Примеры интерактивности

#### Одобрение документа

1. Пользователь открывает документ
2. Нажимает "Одобрить"
3. Статус документа меняется на `approved` в памяти
4. UI обновляется автоматически
5. При следующем открытии документа статус остается `approved`

#### Отправка запроса на строительство

1. Пользователь отправляет запрос на строительство
2. Первый этап проекта переходит в статус `inProgress`
3. Кнопка отправки запроса скрывается
4. Появляется кнопка перехода к документам

#### Изменение статуса проекта

1. После одобрения всех документов появляется кнопка перехода к строительству
2. После отправки запроса этапы проекта обновляются
3. Все изменения сохраняются в памяти до перезапуска

## Использование в репозиториях

### Пример структуры мокового репозитория

```dart
class MockProjectRepository implements ProjectRepository {
  final Ref ref;

  MockProjectRepository(this.ref);

  @override
  Future<List<Project>> getProjects() async {
    // Симуляция задержки сети
    await Future.delayed(const Duration(milliseconds: 500));
    
    // Получаем текущее состояние из провайдера
    final state = ref.read(mockProjectsStateProvider);
    return state;
  }

  @override
  Future<void> requestConstruction(String projectId) async {
    await Future.delayed(const Duration(milliseconds: 500));
    
    // Обновляем состояние проекта
    final projects = await getProjects();
    final project = projects.firstWhere((p) => p.id == projectId);
    
    // Обновляем первый этап на inProgress
    final updatedStages = [
      ConstructionStage(
        id: project.stages.first.id,
        name: project.stages.first.name,
        status: StageStatus.inProgress,
      ),
      ...project.stages.skip(1),
    ];
    
    final updatedProject = Project(
      // ... обновленные данные
      stages: updatedStages,
    );
    
    // Сохраняем в состояние
    ref.read(mockProjectsStateProvider.notifier).updateProject(updatedProject);
  }
}
```

## Видеопотоки

Для демонстрации видеопотоков используются публичные HLS потоки:

- **Камера 1:** `https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8` (Big Buck Bunny)
- **Камера 2:** `https://devstreaming-cdn.apple.com/videos/streaming/examples/img_bipbop_adv_example_fmp4/master.m3u8` (Apple demo)
- **Камера 3:** `https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8` (Unified Streaming demo)

Эти потоки работают через интернет и не требуют настройки.

## Преимущества подхода

1. **Интерактивность** - можно демонстрировать реальное взаимодействие с приложением
2. **Быстрая разработка** - не нужно ждать бэкенд
3. **Полный контроль** - можно создать любые сценарии
4. **Легкое переключение** - один флаг для перехода на реальный API
5. **Тестирование** - легко тестировать edge cases
6. **Демонстрация** - работает офлайн (кроме видеопотоков), не зависит от сети
7. **Состояние сохраняется** - изменения остаются до перезапуска приложения

## Сброс состояния

Для сброса состояния моковых данных:

1. Полностью перезапустите приложение (закройте и откройте заново)
2. Или используйте метод `reset()` в провайдерах (если реализован)

## Добавление новых моковых данных

### Добавление нового проекта

Отредактируйте `lib/core/data/mock_data/projects_mock_data.dart`:

```dart
final mockData = {
  'id': '4',
  'name': 'Новый проект',
  'address': 'ул. Новая, 1',
  // ... остальные поля
};
```

### Добавление нового документа

Отредактируйте `lib/core/data/mock_data/documents_mock_data.dart`:

```dart
{
  'id': '5',
  'projectId': '1',
  'title': 'Новый документ',
  'status': 'pending',
  // ... остальные поля
}
```

### Обновление начального состояния

После изменения статических данных в `mock_data/*.dart`:

1. Перезапустите приложение
2. Состояние загрузится из обновленных данных

## Рекомендации для демонстрации

### Подготовка к демонстрации

1. **Запустите приложение** в режиме разработки (`dev` flavor)
2. **Проверьте все функции:**
   - Просмотр проектов
   - Отправка запроса на строительство
   - Согласование документов
   - Просмотр видеопотоков
   - Чат со специалистом
   - Завершение строительства

3. **Подготовьте сценарий:**
   - Начните с просмотра проектов
   - Отправьте запрос на строительство
   - Одобрите документы по порядку
   - Покажите видеопотоки
   - Продемонстрируйте чат
   - Завершите процесс подписанием документов

### Важные моменты

- ✅ Все функции работают с моками
- ✅ Изменения сохраняются до перезапуска
- ✅ Видеопотоки требуют интернет-соединения
- ✅ Данные сбрасываются при перезапуске приложения

## Переключение на реальный API

Когда будет готов реальный бэкенд:

1. Измените flavor на `staging` или `prod`
2. Обновите `baseUrl` в `app_config_simple.dart`
3. Убедитесь, что `useMocks: false` для этих flavors
4. Приложение автоматически переключится на реальный API

## Технические детали

### Провайдеры состояния

Состояние управляется через Riverpod провайдеры:

- `mockProjectsStateProvider` - состояние проектов
- `mockDocumentsStateProvider` - состояние документов

Эти провайдеры используют `@Riverpod(keepAlive: true)` для сохранения состояния.

### Репозитории

Моковые репозитории находятся в `lib/features/*/data/repositories/mock_*.dart`:

- `MockProjectRepository`
- `MockDocumentRepository`
- `MockConstructionSiteRepository`
- `MockChatRepository`
- `MockFinalDocumentRepository`

Все они реализуют интерфейсы из domain слоя и используют Riverpod для доступа к состоянию.

## FAQ

### Как добавить новые тестовые данные?

Отредактируйте соответствующий файл в `lib/core/data/mock_data/` и перезапустите приложение.

### Как сбросить состояние?

Полностью закройте и перезапустите приложение.

### Работают ли моки без интернета?

Да, кроме видеопотоков, которые требуют интернет-соединения.

### Можно ли использовать моки в production?

Нет, моки предназначены только для разработки и демонстрации. В production всегда используется реальный API.
